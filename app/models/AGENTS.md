# AGENTS.md — Models

<!-- generated by agents-md-generator | last_generated: 2026-02-12 -->

> ActiveRecord models: data access, validations, associations, and domain logic.

## Structure

```
app/models/
├── concerns/                     # Shared model concerns
├── application_record.rb        # Base class
├── bank_question.rb             # Question bank source
├── bank_question_choice.rb      # Bank question choices
├── exam_attempt.rb              # User's exam attempt
├── exam_room.rb                 # Timed exam room
├── exam_session.rb              # Exam instance with questions
├── question.rb                  # Exam question
├── question_choice.rb           # Question answer choice
├── question_correct_answer.rb   # Correct answer mapping
├── question_topic.rb            # Question topic/category
└── user.rb                      # User account
```

## Naming Conventions

| Element | Pattern | Example |
|---------|---------|---------|
| Model file | `snake_case.rb` | `exam_session.rb` |
| Model class | `PascalCase` | `ExamSession` |
| Table name | `snake_case_plural` | `exam_sessions` |
| Associations | `snake_case` | `has_many :questions`, `belongs_to :exam_session` |
| Scopes | `snake_case` verb/adjective | `scope :upcoming`, `scope :started` |

## Rules

### Do

- Add `# frozen_string_literal: true` as first line
- Define validations for required fields and data integrity
- Use `has_many ... dependent: :destroy` for owned associations
- Use scopes for reusable query patterns
- Keep model methods focused on data/domain logic
- Document complex methods with comments

### Don't

- Don't add controller or view logic to models
- Don't use raw SQL with string interpolation — use `where(col: val)`
- Don't skip validations with `save(validate: false)` unless necessary
- Don't define presentation logic — use helpers or decorators

## Dependencies

### Allowed Imports From

- Other models (via associations)
- `app/models/concerns/` for shared behavior

### Must NOT Import From

- `app/controllers/`
- `app/views/`
- `app/services/` — services call models, not vice versa

## Patterns

### ✅ Good — Validation with presence and inclusion

```ruby
validates :question_type, presence: true, inclusion: { in: %w[single multiple] }
validates :body, presence: true
```

### ✅ Good — Scopes for query patterns

```ruby
scope :upcoming, -> { where("starts_at > ?", Time.current) }
scope :started, -> { where("starts_at <= ?", Time.current) }
```

### ✅ Good — Domain method with clear responsibility

```ruby
def correct?(user_choice_keys)
  return false if user_choice_keys.blank?
  Array.wrap(user_choice_keys).map(&:to_s).map(&:upcase).sort == correct_choice_keys
end
```

### ❌ Bad — Controller logic in model

```ruby
def redirect_if_expired
  redirect_to root_path if expired?  # Controllers redirect, not models
end
```

## Related Files

| File | Relationship |
|------|-------------|
| `AGENTS.md` (project root) | Global rules and decision tree — read first |
| `app/controllers/AGENTS.md` | Controllers consume models for data access |
| `app/services/AGENTS.md` | Services use models for business operations |
| `db/AGENTS.md` | Migrations define model schema |
| `test/AGENTS.md` | Model tests in `test/models/` |

## Checklist — New Model

Before creating a new model:

- [ ] File named `snake_case.rb` in `app/models/`
- [ ] Class inherits from `ApplicationRecord`
- [ ] `# frozen_string_literal: true` as first line
- [ ] Migration created in `db/migrate/`
- [ ] Validations defined for required fields
- [ ] Associations defined with appropriate `dependent:` option
- [ ] Scopes added for common query patterns
