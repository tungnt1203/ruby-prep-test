# AGENTS.md — Database

<!-- generated by agents-md-generator | last_generated: 2026-02-12 -->

> Database migrations, schema, and seed data.

## Structure

```
db/
├── migrate/                               # Schema migrations
│   ├── 20260211000000_create_base_schema.rb
│   └── 20260211100000_add_question_bank.rb
├── cable_migrate/                         # Action Cable migrations
├── schema.rb                              # Current schema (auto-generated)
├── queue_schema.rb                        # Solid Queue schema
├── cable_schema.rb                        # Solid Cable schema
└── seeds.rb                               # Seed data for development
```

## Naming Conventions

| Element | Pattern | Example |
|---------|---------|---------|
| Migration file | `{timestamp}_{description}.rb` | `20260211000000_create_base_schema.rb` |
| Migration class | `{Description}` (PascalCase) | `CreateBaseSchema` |
| Table names | `snake_case_plural` | `exam_sessions`, `question_choices` |
| Column names | `snake_case` | `created_at`, `hash_id`, `question_type` |
| Foreign keys | `{table_singular}_id` | `exam_session_id`, `user_id` |

## Rules

### Do

- Add `# frozen_string_literal: true` as first line
- Use `change` method for reversible migrations
- Add indexes for foreign keys and frequently queried columns
- Use `null: false` for required columns
- Use `references` with `foreign_key: true` for associations

### Don't

- Don't edit `schema.rb` manually — it's auto-generated
- Don't write irreversible migrations without explicit `up`/`down` methods
- Don't add business logic to migrations — only schema changes
- Don't use raw SQL unless necessary

## Patterns

### ✅ Good — Reversible migration with indexes

```ruby
# frozen_string_literal: true

class CreateExamSessions < ActiveRecord::Migration[8.1]
  def change
    create_table :exam_sessions do |t|
      t.string :hash_id, null: false
      t.string :exam_title
      t.integer :total_questions, default: 50
      t.timestamps
    end

    add_index :exam_sessions, :hash_id, unique: true
  end
end
```

### ✅ Good — Foreign key with index

```ruby
def change
  add_reference :questions, :exam_session, null: false, foreign_key: true
end
```

## Related Files

| File | Relationship |
|------|-------------|
| `AGENTS.md` (project root) | Global rules — read first |
| `app/models/AGENTS.md` | Models reflect schema structure |

## Checklist — New Migration

Before creating a new migration:

- [ ] Generate with `bin/rails generate migration {Name}`
- [ ] `# frozen_string_literal: true` as first line
- [ ] Use `change` method (or explicit `up`/`down`)
- [ ] Add indexes for foreign keys
- [ ] Run `bin/rails db:migrate` to apply
- [ ] Verify `schema.rb` updated correctly
