# AGENTS.md — Controllers

<!-- generated by agents-md-generator | last_generated: 2026-02-12 -->

> Handle HTTP requests, authentication, session management, and response rendering.

## Structure

```
app/controllers/
├── concerns/                    # Shared controller concerns
├── application_controller.rb   # Base class with auth helpers
├── dashboard_controller.rb     # Host dashboard
├── exams_controller.rb         # Exam taking flow
├── home_controller.rb          # Landing page
├── pre_exams_controller.rb     # Exam creation
├── rooms_controller.rb         # Room management
├── sessions_controller.rb      # Login/logout
└── users_controller.rb         # Registration
```

## Naming Conventions

| Element | Pattern | Example |
|---------|---------|---------|
| Controller file | `{resource}_controller.rb` | `exams_controller.rb` |
| Controller class | `{Resource}Controller` | `ExamsController` |
| Action methods | `snake_case` | `index`, `create`, `find_or_create_attempt` |
| Private methods | `snake_case` | `build_exam_hash`, `require_login` |

## Rules

### Do

- Inherit from `ApplicationController`
- Use `before_action` for auth checks (`require_login`, `require_host`)
- Use strong parameters: `params.require(:model).permit(:field1, :field2)`
- Keep actions under 20 lines — extract logic to private methods or services
- Return early with `redirect_to` and `return` for guard clauses
- Use `flash[:alert]` or `flash[:notice]` for user messages

### Don't

- Don't put business logic in controllers — use services or models
- Don't access `session` directly in views — expose via helper methods
- Don't use `params` without strong parameters
- Don't rescue exceptions silently — let them propagate or handle explicitly

## Dependencies

### Allowed Imports From

- `app/models/` — for data access
- `app/services/` — for business logic
- `app/helpers/` — via Rails helper inclusion

### Must NOT Import From

- Other controllers (except via concerns)
- `app/views/` — views are rendered, not imported
- `app/frontend/` — JS is separate

## Patterns

### ✅ Good — Guard clause with early return

```ruby
def index
  unless @exam_session
    redirect_to root_path, alert: "Exam not found."
    return
  end
  # ... rest of action
end
```

### ❌ Bad — Nested conditionals

```ruby
def index
  if @exam_session
    if @exam_room
      if @exam_room.started?
        # deeply nested logic
      end
    end
  end
end
```

### ✅ Good — Thin action delegating to service

```ruby
def create
  result = CreateExamFromBankService.new.call
  redirect_to exam_path(result[:hash_id])
end
```

### ❌ Bad — Business logic in controller

```ruby
def create
  questions = BankQuestion.order("RANDOM()").limit(50)
  session = ExamSession.create!(...)
  questions.each { |q| copy_question(session, q) }
  # ... 50 more lines of logic
end
```

## Related Files

| File | Relationship |
|------|-------------|
| `AGENTS.md` (project root) | Global rules and decision tree — read first |
| `app/models/AGENTS.md` | Models used by controllers for data access |
| `app/services/AGENTS.md` | Services called by controllers for business logic |
| `app/views/AGENTS.md` | Views rendered by controller actions |
| `test/AGENTS.md` | Controller tests live in `test/controllers/` |

## Checklist — New Controller

Before creating a new controller:

- [ ] File named `{resource}_controller.rb` in `app/controllers/`
- [ ] Class inherits from `ApplicationController`
- [ ] `# frozen_string_literal: true` as first line
- [ ] Routes added in `config/routes.rb`
- [ ] Auth checks via `before_action` if needed
- [ ] Strong parameters for any form submissions
- [ ] Controller test created in `test/controllers/`
