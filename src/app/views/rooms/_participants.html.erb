<% participants_count = room.exam_attempts.count %>
<% submitted_count = room.exam_attempts.where.not(submissions: [nil, ""]).count %>
<% participants = room.exam_attempts.order(created_at: :asc) %>

<div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
  <div class="flex items-center justify-between mb-3">
    <p class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Participants</p>
    <div class="flex items-center gap-3">
      <span class="inline-flex items-center gap-1 text-xs font-medium text-slate-600">
        <span class="h-1.5 w-1.5 rounded-full bg-indigo-500"></span>
        <%= participants_count %> joined
      </span>
      <span class="inline-flex items-center gap-1 text-xs font-medium text-emerald-600">
        <span class="h-1.5 w-1.5 rounded-full bg-emerald-500"></span>
        <%= submitted_count %> submitted
      </span>
    </div>
  </div>
  <% if participants.any? %>
    <div class="max-h-32 overflow-y-auto space-y-1">
      <% participants.each do |attempt| %>
        <div class="flex items-center gap-2 rounded-lg bg-white px-3 py-2">
          <span class="flex h-6 w-6 items-center justify-center rounded-full bg-indigo-100 text-[10px] font-bold text-indigo-700"><%= (attempt.display_name.presence || "?")[0].upcase %></span>
          <span class="text-xs font-medium text-slate-700 flex-1 truncate"><%= attempt.display_name.presence || "Anonymous" %></span>
          <% if attempt.submissions.present? %>
            <span class="flex h-5 w-5 items-center justify-center rounded-full bg-emerald-100 text-emerald-600">
              <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" /></svg>
            </span>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-xs text-slate-400 text-center py-2">Waiting for participants...</p>
  <% end %>
</div>
